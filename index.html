<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Samira â€” Happy Birthday Video</title>
<style>
  :root{ --bg:#0b1226; --accent:#ff5fa8; --muted:#e8f0ff; }
  html,body{height:100%;margin:0;font-family:system-ui, 'Poppins', sans-serif;background:var(--bg);color:var(--muted);display:flex;align-items:center;justify-content:center;padding:18px;}
  .stage{width:100%;max-width:980px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));border-radius:14px;padding:18px;position:relative;overflow:hidden;box-shadow:0 20px 60px rgba(2,6,23,0.6);}
  .stage::before{content:"I love you â€¢ I love you â€¢ I love you â€¢ ";position:absolute;inset:0;opacity:0.06;font-weight:700;font-size:40px;display:flex;align-items:center;justify-content:center;pointer-events:none;color:#ffb3d9;background:repeating-linear-gradient(90deg, transparent 0 120px, rgba(255,255,255,0.012) 120px 240px);mix-blend-mode:overlay;}
  .topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px}
  .title{font-size:18px;font-weight:700}
  .subtitle{font-size:13px;opacity:0.85}
  .viewer{display:flex;gap:14px;align-items:flex-start;flex-wrap:wrap;justify-content:center}
  .photo-wrap{width:420px;height:520px;border-radius:12px;overflow:hidden;background:#111;position:relative;display:flex;align-items:center;justify-content:center}
  canvas#pix{width:100%;height:100%;display:block}
  img#photo{width:100%;height:100%;object-fit:cover;display:none}
  .overlay-text{position:absolute;left:0;right:0;top:12px;text-align:center;color:var(--muted);font-weight:700;pointer-events:none}
  .panel{flex:1;min-width:300px;display:flex;flex-direction:column;gap:12px;align-items:center}
  .msg{background:rgba(255,255,255,0.03);border-radius:12px;padding:12px;width:100%;min-height:84px;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:700}
  .hidden{display:none!important}
  canvas#particles{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:30}
  .cake-area{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:12px;width:100%;display:flex;flex-direction:column;gap:10px;align-items:center}
  .cake{width:260px;height:160px;border-radius:12px;background:linear-gradient(180deg,#fff3f8,#ffd9ee);position:relative;display:flex;align-items:center;justify-content:center;box-shadow:0 12px 30px rgba(0,0,0,0.2)}
  .candle{position:absolute;top:-26px;left:50%;transform:translateX(-50%);display:flex;flex-direction:column;align-items:center;gap:4px}
  .candle .num{background:#fff;border-radius:8px;padding:4px 8px;font-weight:800;color:#b33078;box-shadow:0 6px 18px rgba(179,48,120,0.15)}
  .candle .flame{width:14px;height:22px;border-radius:8px;background:linear-gradient(180deg,#ffd166,#ff7aa2);margin-top:2px;box-shadow:0 6px 20px rgba(255,120,160,0.25)}
  .controls{display:flex;gap:8px;align-items:center;margin-top:6px}
  .btn{padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700;background:linear-gradient(90deg,var(--accent),#ffd166);color:#071028;box-shadow:0 8px 20px rgba(2,6,23,0.12)}
  .gift{width:120px;height:120px;background:#fff;border-radius:10px;display:flex;align-items:center;justify-content:center;position:relative;cursor:pointer}
  .gift .lid{position:absolute;top:8px;left:50%;transform:translateX(-50%);width:84px;height:36px;background:#ff5fa8;border-radius:8px}
  .wishes{display:flex;flex-direction:column;gap:6px;align-items:center;margin-top:8px}
  .wish{background:rgba(255,255,255,0.04);padding:6px 10px;border-radius:8px;font-weight:700}
  .credit{margin-top:8px;font-size:12px;opacity:0.9}
</style>
</head>
<body>
<div class="stage" id="stage">
  <canvas id="particles"></canvas>
  <div class="topbar">
    <div>
      <div class="title">A surprise for Samira</div>
      <div class="subtitle">Made by Mehboob â€” enjoy ðŸŽ‰</div>
    </div>
    <div class="subtitle">Auto-play animations â€” click/tap to begin</div>
  </div>
  <div class="viewer">
    <div class="photo-wrap" id="photoWrap">
      <div class="overlay-text">Preparing your photo...</div>
      <canvas id="pix"></canvas>
      <img id="photo" src="photo.jpg" alt="photo">
    </div>
    <div class="panel">
      <div id="introMsg" class="msg">Loading... please tap to start reveal</div>
      <div class="cake-area" id="cakeArea">
        <div class="cake" id="cake">
          <div class="candle" id="candle">
            <div class="num">18</div>
            <div class="flame" id="flame"></div>
          </div>
          <div style="font-weight:800;color:#b33078">ðŸŽ‚ Cake</div>
        </div>
        <div class="controls">
          <button class="btn" id="cutBtn">Cut the cake</button>
          <button class="btn" id="resetCuts">Reset cuts</button>
          <div style="font-size:13px;color:#eaf0ff;padding-left:8px">Cuts: <span id="cutCount">0</span></div>
        </div>
      </div>
      <div style="display:flex;gap:12px;align-items:center;margin-top:12px">
        <div class="gift" id="gift">
          <div class="lid"></div>
        </div>
        <div class="wishes" id="wishes"></div>
      </div>
      <div class="credit" id="credit">Made by Mehboob for Jaan Samira</div>
    </div>
  </div>
</div>
<script>
const photo = document.getElementById('photo');
const pix = document.getElementById('pix');
const pctx = pix.getContext('2d');
const introMsg = document.getElementById('introMsg');
const particlesCanvas = document.getElementById('particles');
const particlesCtx = particlesCanvas.getContext('2d');
const stage = document.getElementById('stage');
const photoWrap = document.getElementById('photoWrap');
let cuts = 0;
let cutMessagesInterval = null;
function resizeAll(){
  const r = photoWrap.getBoundingClientRect();
  const ratio = window.devicePixelRatio || 1;
  pix.width = Math.round(r.width * ratio);
  pix.height = Math.round(r.height * ratio);
  pix.style.width = r.width + "px";
  pix.style.height = r.height + "px";
  pctx.setTransform(ratio,0,0,ratio,0,0);
  particlesCanvas.width = Math.round(stage.clientWidth * ratio);
  particlesCanvas.height = Math.round(stage.clientHeight * ratio);
  particlesCanvas.style.width = stage.clientWidth + "px";
  particlesCanvas.style.height = stage.clientHeight + "px";
  particlesCtx.setTransform(ratio,0,0,ratio,0,0);
}
window.addEventListener('resize', resizeAll);
resizeAll();
function pixelateThenReveal(img){
  return new Promise((resolve)=>{
    const w = pix.width, h = pix.height;
    let scale = 0.04;
    const steps = 28;
    let frame = 0;
    function step(){
      const sw = Math.max(2, Math.floor(w*scale));
      const sh = Math.max(2, Math.floor(h*scale));
      const off = document.createElement('canvas');
      off.width = sw; off.height = sh;
      const oc = off.getContext('2d');
      oc.drawImage(img, 0, 0, img.naturalWidth, img.naturalHeight, 0,0, sw, sh);
      pctx.imageSmoothingEnabled = false;
      pctx.clearRect(0,0,pix.width,pix.height);
      pctx.drawImage(off, 0,0, sw, sh, 0,0, pix.width/ (window.devicePixelRatio||1), pix.height/(window.devicePixelRatio||1));
      frame++;
      scale = Math.min(1, scale + (1-0.04)/steps);
      if(frame <= steps){
        requestAnimationFrame(step);
      } else {
        setTimeout(()=>{
          photo.style.display = "block";
          pix.style.opacity = 0;
          setTimeout(()=> pix.classList.add('hidden'), 350);
          resolve();
        }, 250);
      }
    }
    step();
  });
}
let particles = [];
function spawnParticle(x,y, opts = {}){
  const angle = (Math.random()*Math.PI*2);
  particles.push(Object.assign({
    x, y,
    vx: Math.cos(angle)*(Math.random()*3+1),
    vy: Math.sin(angle)*(Math.random()*3-1.5),
    life: Math.random()*120 + 30,
    size: Math.random()*6+3,
    shape: 'dot',
    color: opts.color || `hsl(${Math.random()*360},80%,60%)`
  }, opts));
}
function updateParticles(){
  particlesCtx.clearRect(0,0,particlesCanvas.width,particlesCanvas.height);
  for(let i=particles.length-1;i>=0;i--){
    const p = particles[i];
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.08;
    p.life--;
    particlesCtx.fillStyle = p.color;
    particlesCtx.beginPath();
    particlesCtx.arc(p.x, p.y, p.size/2, 0, Math.PI*2);
    particlesCtx.fill();
    if(p.life<=0) particles.splice(i,1);
  }
  requestAnimationFrame(updateParticles);
}
requestAnimationFrame(updateParticles);
async function startReveal(){
  introMsg.textContent = "Pixelating & loading photo...";
  if(!photo.complete || photo.naturalWidth===0){
    introMsg.textContent = "Put your photo into the folder as 'photo.jpg' and reload this page.";
    return;
  }
  resizeAll();
  await pixelateThenReveal(photo);
  introMsg.textContent = "Happiest Birthday jaan";
  for(let i=0;i<140;i++) spawnParticle(pix.width*Math.random()/ (window.devicePixelRatio||1), pix.height*Math.random()/ (window.devicePixelRatio||1), {color: i%3? '#ff5fa8':'#ffd166'});
  setTimeout(()=>{
    introMsg.textContent = "";
    particles = [];
  }, 3500);
  setTimeout(()=>{
    introMsg.textContent = "Click 'Cut the cake' to begin the cake-cuts sequence";
  }, 4200);
}
const cutBtn = document.getElementById('cutBtn');
const cutCountEl = document.getElementById('cutCount');
const cake = document.getElementById('cake');
const wishesBox = document.getElementById('wishes');
const gift = document.getElementById('gift');
function showHappyMessagesCycle(){
  const messages = ["Happy Birthday jaan","Happy Birthday jaanu","Happy Birthday wifuuu","Happy Birthday cutie pie"];
  let idx = 0;
  const duration = 120000;
  const interval = 4000;
  const start = Date.now();
  cutMessagesInterval = setInterval(()=>{
    const elapsed = Date.now() - start;
    if(elapsed > duration){ clearInterval(cutMessagesInterval); return; }
    introMsg.textContent = messages[idx % messages.length];
    idx++;
    for(let i=0;i<40;i++) spawnParticle(stage.clientWidth*Math.random(), stage.clientHeight*0.2 + Math.random()*stage.clientHeight*0.7, {color: i%2? '#ff5fa8':'#ffd166', shape: i%6? 'dot':'heart', size: 8});
    setTimeout(()=> introMsg.textContent = "", 1600);
  }, interval);
}
cutBtn.addEventListener('click', ()=>{
  cuts++;
  cutCountEl.textContent = cuts;
  cake.animate([{transform:'scale(1)'},{transform:'scale(0.96)'},{transform:'scale(1)'}],{duration:400,iterations:1});
  for(let i=0;i<40;i++){
    spawnParticle(stage.clientWidth*0.5 + (Math.random()-0.5)*120, stage.clientHeight*0.4 + (Math.random()-0.5)*40, {color: Math.random()>0.5? '#ff5fa8':'#ffd166', shape: Math.random()>0.6? 'heart':'dot', size: 8});
  }
  introMsg.textContent = "Happy Birthday jaan!";
  setTimeout(()=> introMsg.textContent = "", 1800);
  if(cuts===1){
    showHappyMessagesCycle();
  }
  if(cuts >= 6){
    for(let i=0;i<80;i++) spawnParticle(stage.clientWidth*Math.random(), stage.clientHeight*Math.random(), {color: '#ff6b9e', shape: 'heart', size: 10});
  }
});
document.getElementById('resetCuts').addEventListener('click', ()=>{
  cuts = 0;
  cutCountEl.textContent = cuts;
  if(cutMessagesInterval) { clearInterval(cutMessagesInterval); cutMessagesInterval = null; }
  introMsg.textContent = "Cuts reset.";
  setTimeout(()=> introMsg.textContent = "", 1400);
});
gift.addEventListener('click', ()=>{
  const lid = gift.querySelector('.lid');
  lid.animate([{transform:'translateY(0)'},{transform:'translateY(-30px) rotate(-6deg)'}],{duration:600,fill:'forwards'});
  const start = Date.now();
  const span = 20000;
  const t = setInterval(()=>{
    for(let i=0;i<10;i++){
      spawnParticle(stage.clientWidth*0.7 + (Math.random()-0.5)*200, stage.clientHeight*0.3 + Math.random()*200, {shape: Math.random()>0.5?'heart':'dot', color: Math.random()>0.5? '#ff5fa8':'#72c0ff', size: 10});
    }
    if(Date.now()-start > span){ clearInterval(t); showWishesList(); }
  }, 300);
});
function showWishesList(){
  const list = [
    "Happy Birthday jaan",
    "Happy Birthday jaanu",
    "Happy Birthday wifuuu",
    "Happy Birthday cutie pie",
    "May all your dreams come true",
    "Love you always â€” Mehboob"
  ];
  wishesBox.innerHTML='';
  let idx=0;
  const iw = setInterval(()=>{
    if(idx >= list.length){ clearInterval(iw); return; }
    const el = document.createElement('div');
    el.className = 'wish';
    el.textContent = list[idx];
    wishesBox.appendChild(el);
    for(let i=0;i<30;i++) spawnParticle(stage.clientWidth*0.6 + (Math.random()-0.5)*300, stage.clientHeight*0.4 + Math.random()*200, {color: i%2? '#ff5fa8':'#ff6b6b', shape: 'heart', size: 10});
    const kiss = document.createElement('div');
    kiss.textContent = "ðŸ’‹";
    kiss.style.position = 'absolute';
    kiss.style.left = (photoWrap.offsetLeft + photoWrap.offsetWidth*0.6 + Math.random()*40) + 'px';
    kiss.style.top = (photoWrap.offsetTop + 40 + Math.random()*40) + 'px';
    kiss.style.fontSize = '28px';
    kiss.style.opacity = '0';
    stage.appendChild(kiss);
    kiss.animate([{transform:'translateY(0) scale(1)', opacity:1},{transform:'translateY(-40px) scale(0.6)', opacity:0}],{duration:1400,fill:'forwards'});
    setTimeout(()=> kiss.remove(), 1500);
    idx++;
  }, 1500);
}
let started = false;
function beginAll(){
  if(started) return;
  started = true;
  startReveal();
}
document.addEventListener('click', beginAll, {once:true});
document.addEventListener('touchstart', beginAll, {once:true});
</script>
</body>
</html>
